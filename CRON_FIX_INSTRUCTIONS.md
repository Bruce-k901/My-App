# Cron Job Fix Instructions

## Issue Identified

The daily tasks were being generated by a database-level cron job
(`generate_daily_tasks_direct`) that was introduced in a recent migration. This
function had two major flaws:

1. It generated tasks directly from **Templates** instead of **Site Checklists**
   (Configurations).
2. As a result, it ignored `equipment_config`, causing tasks to be created
   without selected assets or temperature fields.

## The Fix

1. **Frontend**: We updated `TaskFromTemplateModal.tsx` to correctly save
   "Monitor/Callout" events to the task history.
2. **Backend**: We have disabled the incorrect database cron job via migration
   `20250222000001_disable_db_cron.sql`.

## Action Required: Schedule Edge Function

You must ensure the **Edge Function** (`generate-daily-tasks`) is scheduled to
run daily at 3:00 AM. This function contains the correct logic to read from
`site_checklists` and populate all task data.

### Option 1: Via Supabase Dashboard

1. Go to your Supabase Dashboard > Edge Functions.
2. Find `generate-daily-tasks`.
3. Check if it has a schedule. If not, add a cron schedule: `0 3 * * *` (3:00
   AM).

### Option 2: Via SQL (if you know your Project URL and Anon Key)

Run the following SQL in the Supabase SQL Editor, replacing the placeholders:

```sql
select cron.schedule(
  'generate-daily-tasks-edge',
  '0 3 * * *',
  $$
  select
    net.http_post(
      url:='https://<YOUR_PROJECT_REF>.supabase.co/functions/v1/generate-daily-tasks',
      headers:='{"Content-Type": "application/json", "Authorization": "Bearer <YOUR_ANON_KEY>"}'::jsonb
    ) as request_id;
  $$
);
```

### Verification

After scheduling, check the Edge Function logs to ensure it runs successfully
and creates the correct number of tasks.
